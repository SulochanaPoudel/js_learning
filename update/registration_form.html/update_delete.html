<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Update_Delete_Form</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous">
        <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <body>
        <div class="container">
            <form class="my-5 border border-3 border-dark bg-info-subtle">
                <h1 class="text-center my-5">Registration Form</h1>
                <div class="form m-5 text-center">
                    <div><b class="m-3">Name:</b><input class="text-center m-2"
                            id="name" type="text" placeholder="Name"></div>
                    <div><b class="m-3">Phone:</b><input class="text-center m-2"
                            id="contact" type="text" placeholder="Phone"></div>
                    <div><b class="m-3 ">E-mail:</b> <input
                            class="text-center m-2" id="email" type="email"
                            placeholder="E-mail"></div>
                    <br>
                    <button class="bg-dark-subtle px-3 text-dark" id="submit"
                        onclick="submitForm()" type="button">Submit</button>
                    <br>
                    <br>
                </div>
            </form>

            <div class="m-5">
                <table id="display"
                    class="table table-primary table-striped table-bordered border-dark"
                    style="margin:auto">
                    <thead>
                        <tr class="text-center ">
                            <th>Name</th>
                            <th>Phone</th>
                            <th>E-mail</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr class="p-3 text-center"></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- javascript -->
        <script>
        var registrationData = [];

        function checkDuplicate(newUserInput) {
            if (registrationData.some(function (data) {
                    return data.name === newUserInput.name &&
                        data.contact === newUserInput.contact &&
                        data.email === newUserInput.email;
                })) {
                return true;
            }
            return false;
        }

        function submitForm() {
            const inputName = document.getElementById("name").value;
            const inputContact = document.getElementById("contact").value;
            const inputEmail = document.getElementById("email").value;

            if (inputName && inputContact && inputEmail) {
                var newUserInput = { name: inputName, contact: inputContact, email: inputEmail };
                if (checkDuplicate(newUserInput)) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Duplicate entry! Please provide unique information.',
                    });
                } else {
                    registrationData.push(newUserInput);
                    updateTable();
                    clearInputFields();
                }
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'All fields are required!',
                });
            }
        }

        function updateTable() {
            var tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = "";

            for (var i = 0; i < registrationData.length; i++) {
                var data = registrationData[i];
                var newRow = tableBody.insertRow(tableBody.rows.length);

                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        var cell = newRow.insertCell();
                        cell.innerHTML = data[key];
                    }
                }

                // Add "Remove" button
                var actionButtonCell = newRow.insertCell();
                var removeButton = document.createElement("button");
                removeButton.innerHTML = "Remove";
                removeButton.className = "btn btn-danger pl-2 ms-5 ";

                removeButton.onclick = function (data) {
                    return function () {
                        Swal.fire({
                            title: "Are you sure?",
                            text: "Once deleted, you will not be able to recover this data!",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#dc3545",
                            cancelButtonColor: "#6c757d",
                            confirmButtonText: "Yes, delete it!",
                        }).then(function (result) {
                            if (result.isConfirmed) {
                                removeTableRow(data.name, data.contact, data.email);
                                Swal.fire("Deleted!", "Your data has been deleted.", "success");
                            } else {
                                Swal.fire("Cancelled", "Your data is safe!", "info");
                            }
                        });
                    };
                }(data);

                actionButtonCell.appendChild(removeButton);

                // Add "Edit" button
                var editButton = document.createElement("button");
                editButton.innerHTML = "Edit";
                editButton.className = "btn btn-warning pl-3 ms-5";

                editButton.onclick = function (data) {
                    return function () {
                        document.getElementById("name").value = data.name;
                        document.getElementById("contact").value = data.contact;
                        document.getElementById("email").value = data.email; 
                        document.getElementById("submit").innerHTML = "Update Change";
                        document.getElementById("submit").className = "btn btn-warning px-3 text-dark";
                        // document.getElementById("submit").style.display = "None";
                        document.getElementById("submit").onclick = function () {
            saveEditedData(data);
        };
                    };
                }(data);

                actionButtonCell.appendChild(editButton);
            }
        }

        function saveEditedData(dataToEdit) {
    const editedName = document.getElementById("name").value;
    const editedContact = document.getElementById("contact").value;
    const editedEmail = document.getElementById("email").value;

    if (editedName && editedContact && editedEmail) {
        // Find the index of the data to edit
        const indexToEdit = registrationData.findIndex(function (data) {
            return data.name === dataToEdit.name &&
                   data.contact === dataToEdit.contact &&
                   data.email === dataToEdit.email;
        });

        // Update the data at the found index
        registrationData[indexToEdit] = {
            name: editedName,
            contact: editedContact,
            email: editedEmail,
        };

        // Update the table and reset the form
        updateTable();
        clearInputFields();

        // Change the "Save" button back to "Submit"
        document.getElementById("submit").innerHTML = "Submit";
        document.getElementById("submit").onclick = submitForm;
    } else {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'All fields are required!',
        });
    }
}







        function removeTableRow(name, contact, email) {
            var indexToRemove = registrationData.findIndex(function (data) {
                return data.name === name && data.contact === contact && data.email === email;
            });

            if (indexToRemove !== -1) {
                registrationData.splice(indexToRemove, 1);
                updateTable();
            } else {
                alert("unable");
            }
        }

        function clearInputFields() {
            document.getElementById("name").value = "";
            document.getElementById("contact").value = "";
            document.getElementById("email").value = "";
        }
    </script>
    </body>
</html>
